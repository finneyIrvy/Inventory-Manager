@model List<Inventory_Management_System__Miracle_Shop_.Models.Folder>

@using Microsoft.AspNetCore.Identity
@inject UserManager<NewUserClass> _usermanager
@inject SignInManager<NewUserClass> signInManager

@{
    var isAuthenticated = signInManager.IsSignedIn(User); // Use SignInManager for better checking
    NewUserClass user = null;

    if (isAuthenticated)
    {
        user = await _usermanager.GetUserAsync(User); // Asynchronously get the user if authenticated
    }
}



@if (user != null)
{
    <p>Welcome, @user.FirstName</p>
}
else
{
    <p>Welcome, guest!</p>
}

<!-- Add Folder Button -->
<a href="javascript:void(0);" class="btn btn-sm mb-3" style="font-family: 'Raleway', sans-serif;background-color: #008080;color: white;" data-bs-toggle="modal" data-bs-target="#addFolderModal">
    Add-Folder
</a>



<!-- Modal -->
<div class="modal fade" id="addFolderModal" tabindex="-1" aria-labelledby="addFolderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style="font-family: 'Raleway', sans-serif; color: #FF6F00;"  id="addFolderModalLabel">Create New Folder</h5>
               
            </div>
            <div class="modal-body">
                <form asp-action="CreateFolder" method="post" id="createFolderForm">
                    <div class="form-group">
                        <label for="folderName">Folder Name</label>
                        <input type="text" class="form-control" id="folderName" name="folderName" required />
                    </div>
                    <div class="mt-3">
                        <button type="submit"  id="submitButton" class="btn btn-sm" style="font-family: 'Raleway', sans-serif;background-color: #008080; color: white;">
                            Create 
                            <span id="spinner" class="spinner-border spinner-border-sm text-light" role="status" aria-hidden="true" style="display: none;"></span>
                        </button>
                        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>

@if (TempData["Message"] != null)
{
    // Ensure both sides of comparison are strings
    var messageType = TempData["MessageType"] as string;

    <div class="alert @(messageType == "success" ? "alert-success" : (messageType == "error" ? "alert-danger" : "")) mt-2 col-md-4">
        @TempData["Message"]
    </div>
}

<h5 class=" mb-3"  style="font-family: 'Raleway', sans-serif; color: #FF6F00;">Folders</h5>

@if (Model.Any())
{
    <ul class="mt-2">
        @foreach (var folder in Model)
        {
            <li>
                <a href="@Url.Action("FolderDetails", "Home", new { id = folder.FolderID })">
                    @folder.FolderName
                </a>
            </li>
        }
    </ul>
}
else
{
    <ul>
       <li>
            <a>No Folders</a>
        </li>
    </ul>
}

<!-- Scripts for Modal (Bootstrap 5) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript for Handling Spinner -->
<script>
    document.getElementById('createFolderForm').addEventListener('submit', function (event) {
        // Show the spinner and disable the submit button to prevent multiple submissions
        document.getElementById('spinner').style.display = 'inline-block';
        document.getElementById('submitButton').disabled = true;
    });
</script>
